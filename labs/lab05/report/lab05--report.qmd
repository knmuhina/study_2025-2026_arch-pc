---
# Author
author:
  name: Мухина Ксения Николаевна
  email: 1032253531@pfur.ru
  affilation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 115419
      city: Москва
      address: ул. Орджоникидзе, д. 3

## Title
title: "Отчёт по лабораторной работе №5"
subtitle: "Дисциплина: Архитектура компьютеров"
licence: "CC BY-NC"
---

# Цель работы

Приобрести практические навыки работы в Midnight Commander. Освоить инструкции языка ассемблера mov и int.

# Выполнение лабораторной работы

Далее описываемая работа была выполнена на виртуальной машине Oracle VirtualBox с ОС Linux Ubuntu.

Откроем Midnight Commander, введя mc. Далее перейдём в каталог ~/work/arch-pc и при помощи клавиши F7 создадим в нём каталог lab05.

![Создание каталога в Midnight Commander.](image/shot-01.png){#shot-01 width=70%}

Перейдя в созданный каталог, используем строку ввода для выполнения команды touch и создания файла lab5-1.asm.

![Создание файла asm.](image/shot-02.png){#shot-02 width=70%}

Файл был успешно создан. При помощи клавиши F4 откроем файл в редакторе mcedit и введём текст будущей программы, далее сохраним изменения и закроем файл.

С помощью клавиши F3 откроем файл для просмотра и убедимся, что файл содержит введённый текст.

![Текст программы вывода сообщения и ввода строки.](image/shot-03.png){#shot-03 width=70%}

Файл действительно содержит текст будущей программы. Оттранслируем его в объектный файл, выполним компоновку объектного файла и запустим получившийся исполняемый файл.

![Запуск программы lab5-1.](image/shot-04.png){#shot-04 width=70%}

В качестве ответа на запрос мы ввели ФИО автора отчёта.

1. Подключение внешнего файла in_out.asm

Для упрощения написания программ в будущих лабораторных работах мы будем подключать внешний файл in_out.asm, содержащий необходимые подпрограммы. Данные подпрограммы будут использоваться для исключения одинаковых участков кода.

Внешние файлы подключаются с помощью директивы %include. Директива программы должна стоять раньше вызовов подпрограмм из подключаемого файла. Для вызова подпрограммы из внешнего файла используется инструкция call, имеющая вид:

call function

где function - имя подпрограммы.

Скачаем файл со страницы курса в ТУИС. Скопируем файл из каталога Загрузки в каталог с файлом lab5-1 с использованием клавиши F5.

![Копирование внешнего файла в каталог lab05.](image/shot-05.png){#shot-05 width=70%}

После успешного копирования файла с подпрограммами создадим копию файла lab5-1.asm.

![Создание копии файла lab5-1.asm.](image/shot-06.png){#shot-06 width=70%}

В соответствии с листингом, приведённым в лабораторной работе, исправим текст программы в созданной копии файла с использованием подпрограмм из внешнего файла.

![Изменённый текст программы вывода сообщения и ввода строки.](image/shot-07.png){#shot-07 width=70%}

Создадим исполняемый файл и проверим его работу.

![Запуск программы.](image/shot-08.png){#shot-08 width=70%}

Программа работает успешно.

Далее в файле lab5-2.asm заменим подпрограмму sprintLF на sprint и проверим работу программы.

![Запуск изменённой программы.](image/shot-09.png){#shot-09 width=70%}

Как мы видим, с изменением подпрограммы при запросе ввода с клавиатуры программа не переводит строку, а ожидает ответ на той же строке.

# Задания для самостоятельной работы

Создадим копию файла lab5-1.asm с названием lab5-1a.asm. Внесём изменения программу, чтобы после запроса ввода с клавиатуры она выдала введённую строку.

**Листинг 1. Программа lab5-1a.asm**

	SECTION .data
	msg: DB 'Введите строку: ',10
	msgLen: EQU $-msg

	SECTION .bss
	buf1: RESB 80

	SECTION .text
	GLOBAL _start
	 _start:
	  mov eax, 4
	  mov ebx, 1
	  mov ecx, msg
	  mov edx, msgLen
	  int 80h
	  mov eax, 3
	  mov ebx, 0
	  mov ecx, buf1
	  mov edx, 80
	  int 80h
	  mov eax, 4
	  mov ebx, 1
	  mov ecx, buf1
	  mov edx, 80
	  int 80h
	  mov eax, 1
	  mov ebx, 0
	  int 80h

Проверим работу программы.

![Работа программы lab5-1a.asm.](image/shot-10.png){#shot-10 width=70%}

Программа работает корректно.

Далее создадим копию файла lab5-2.asm с названием lab5-2a.asm. Внесём изменения программу, чтобы после запроса ввода с клавиатуры она выдала введённую строку.

**Листинг 2. Программа lab5-2a.asm**

	%include 'in_out.asm'

	SECTION .data
	msg: DB 'Введите строку: ',0h

	SECTION .bss
	buf1: RESB 80

	SECTION .text
	GLOBAL _start
	 _start:
	  mov eax, msg
	  call sprint
	  mov ecx, buf1
	  mov edx, 80
	  call sread
	  mov eax, buf1
	  mov edx, 80
	  call sprint
	  call quit

Проверим работу программы.

![Работа программы lab5-2a.asm.](image/shot-11.png){#shot-11 width=70%}

Программа работает корректно.

# Выводы

В ходе выполнения лабораторной работы мы приобрели практические навыки работы в Midnight Commander, а также освоили инструкции языка ассемблера mov и int.

# Список литературы{.unnumbered}

1. Файл ["Лабораторная работа №5. Основы работы с Midnight Commander (mc). Структура программы на языке ассемблера NASM. Системные вызовы в ОС GNU Linux.pdf"](https://esystem.rudn.ru/mod/resource/view.php?id=1030553)
